/* tail.BBSolid 0.1.1 @ https://github.com/pytesNET/tail.BBSolid */
!function(e){"function"==typeof define&&define.amd?define(e):"object"==typeof module&&module.exports?module.exports=e():(void 0===window.tail&&(window.tail={}),window.tail.BBSolid=e())}(function(){"use strict";var m=function(e,t){return m.parse(e,t)};return m.status="alpha",m.version="0.1.1",m.conf={debug:!1,allowedHTML:!1,prettyPrint:!0,wrapParagraphs:!0,showLineBreaks:!0,removeUnparsed:!1},m.error=!1,m.errors=[],m.parsed=null,m.content=null,m.options={},m.join=function(e,t,n,r,i){var o=[];if(typeof e instanceof Array)for(var l=e.length,a=0;a<l;a++)o.push(e[a][0]+t+n+e[a][1]+n+r);else for(var s in e)o.push(s+t+n+e[s]+n+r);return o.join(i)},m.attr=function(e){return this.join(e,"=",'"',""," ")},m.prop=function(e){return this.join(e,":","",";","")},m.args=function(o,e){if("string"!=typeof e)return{};var l={};return e.replace(/(\=| [a-z0-9]+\=)(?:(\'|\")(.*?)\2|([^\s]*))/gi,function(e,t,n,r,i){0<(t="="==t&&null==o[0]?o[1]:t.substr(0,t.length-1)).length&&(l[t]=n?r:i)}),l},m.debug=function(e,t,n){var r={res_cp:"Restriction Error: The BBTag :tag requires one of these Parent Tags: :parents!",res_pc:"Restriction Error: The Parent BBTag :parent does only accept one of these Child Tags: :children!",order:"Incorrect Order: The Children BBTag :tag was closed after the Parent BBTag :parent! (First-In, Last-Out)",invalid:"Unknown: The BBTag :tag is invalid or unknown!"};if(e=e in r?r[e]:e,e+="number"==typeof n?" @ Index "+n:"","object"==typeof t)for(var i in t)e=e.replace(new RegExp(i,"gi"),t[i]);this.options.debug&&console.error(e),this.errors.push(e)},m.parse=function(e,t){var r,l=this;return this.error=!1,this.errors=[],this.parsed=null,this.content=e,this.options=r=function(e,t){t="object"==typeof t?t:{};var n=e.constructor();for(var r in e)t.hasOwnProperty(r)?n[r]=t[r]:e.hasOwnProperty(r)&&(n[r]=e[r]);return n}(this.conf,t),this.prepare(),e=(e=e.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")).replace(this.regA,function(e,t,n,r,i,o){return l.tokenizer.call(l,e,t,n,r,i,o)}).replace(/\[/g,"&#91;").replace(/\]/g,"&#93;"),e=this.fixSingles(e),r.wrapParagraphs&&(e=this.fixParagraphs(e)),e=(e=e.replace(this.regC,function(e,t,n,r,i){return l.replacer.call(l,e,t,n,r,i)})).replace(/<(\/)?BBC=[0-9]+ ([^\s>]+)(?:[ =][^>]*?)?>/gi,function(e,t,n){return r.removeUnparsed?"":"&#91;"+(t?"/":"")+n+"&#93;"}),!0===r.allowedHTML?e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">"):r.allowedHTML instanceof Array&&(e=e.replace(new RegExp("&lt;("+r.allowedHTML.join("|")+")( .*?)?&gt;","gi"),"<$1$2>").replace(new RegExp("&lt;/("+r.allowedHTML.join("|")+")&gt;","gi"),"</$1>")),this.error=0<this.errors.length,this.parsed=e,this.parsed},m.prepare=function(){var e;for(var t in this.tags={all:[],close:[],nonClose:[],container:[]},m.Markups){if("string"==typeof(e=m.Markups[t])){if(!(e in m.Markups)||"string"==typeof m.Markups[e])continue;e=m.Markups[e]}else if(!0===e.placeholder)continue;this.tags.all.push(t),this.tags[(e.single?"nonC":"c")+"lose"].push(t),e.container&&this.tags.container.push(t)}var n=this.tags.all.join("|").replace(/\*/g,"\\*"),r=this.tags.close.join("|").replace(/\*/g,"\\*"),i=this.tags.nonClose.join("|").replace(/\*/g,"\\*");return this.regA=new RegExp("(?:\\[("+n+")([ =][^\\]]*?)?\\]|\\[/("+r+")\\])","gi"),this.regB=new RegExp("<BBC=([0-9]+) ("+i+")([ =][^>]*?)?>","gi"),this.regC=new RegExp("<BBC=([0-9]+) ("+n+")([ =][^>]*?)?>((?:.|[\\r\\n])*?)</BBC=\\1 \\2>","gi"),this.lexer={last:null,depth:0,order:[]},!(this._noParse=!1)},m.tokenizer=function(e,t,n,r,i,o){var l=t||r,a=this.get(l);if(!a)return e;if(!t&&"parse"in a&&!1===a.parse){if(this._noParse=!1,"string"==typeof a.open&&0==a.open.length)return""}else{if(this._noParse)return t?"&#91;"+l+(n||"")+"&#93;":"&#91;/"+l+"&#93;";if(t&&"parse"in a&&!1===a.parse&&(this._noParse=!0,"string"==typeof a.open&&0==a.open.length))return""}if(t){var s=this.get(this.lexer.last);if(s&&s.children&&s.children.indexOf(l)<0)return this.debug("res_pc",{":parent":this.lexer.last,":children":s.children.join(", ")},i),e;if(a.parents&&a.parents.indexOf(this.lexer.last)<0)return this.debug("res_cp",{":tag":l,":parents":a.parents.join(", ")},i),e}return t?(null===this.lexer.last||a.single||this.lexer.order.push(this.lexer.last),a.single?e="<BBC="+this.lexer.depth+" "+l+(n||"")+">":(this.lexer.last=l,e="<BBC="+this.lexer.depth+++" "+l+(n||"")+">")):r&&(l!==this.lexer.last&&this.debug("order",{":tag":l,":parent":this.lexer.last},i),e="</BBC="+--this.lexer.depth+" "+l+">",0<this.lexer.order.length?this.lexer.last=this.lexer.order.pop():this.lexer.last=null),e},m.fixSingles=function(d){return d.replace(this.regB,function(e,t,n,r,i,o){var l=m.get(n);if("display"in l&&!1===l.display)return d=(u=(u=d.substr(0,i+e.length+(d.length-o.length)))+"</BBC="+t+" "+n+">")+(h=d.substr(i+e.length+(d.length-o.length)));var a,s=l.parents.join("|").replace(/\*/g,"\\*"),c=(parseInt(t)-1).toString(),p="(<BBC="+t+" ("+n.replace(/\*/g,"\\*")+")([ =][^>]*?)?>|</BBC="+c+" ("+s+")>)";(p=new RegExp(p,"gi")).lastIndex=i+(d.length-o.length)+1,a=p.exec(d);var u=d.substr(0,p.lastIndex-a[0].length),h=d.substr(p.lastIndex-a[0].length),g=u.substr(0,u.replace(/[\s\uFEFF\xA0]+$/g,"").length),f=u.substr(u.replace(/[\s\uFEFF\xA0]+$/g,"").length);d=g+"</BBC="+t+" "+n+">"+f+h}),d},m.fixParagraphs=function(e){var t=this.tags.container.join("|").replace(/\*/g,"\\*"),o=this,n=new RegExp("(^|<\\/BBC=0 (?:"+t+")>)((?:.|[\\r\\n])*?)(<BBC=0 (?:"+t+")(?:[ =][^>]*?)?>|$)","gi");return e=e.replace(n,function(e,t,n,r,i){return 0==n.replace(/[\s\uFEFF\xA0]+/gi,"").length?e:(o.options.prettyPrint?(n=n.replace(/(^[\s\uFEFF\xA0]+|^)/i,"$1<p>").replace(/([\s\uFEFF\xA0]+$|$)/i,"</p>$1"),n=0<r.length?n.replace(new RegExp("\\n\\n([^"+r+"])","g"),"</p>[br]<p>$1"):n.replace(new RegExp("\\n\\n","g"),"</p>[br]<p>"),n=(n=o.options.showLineBreaks?n.replace(new RegExp("\\n([^\\n"+r+"])","g"),"<br />\n$1"):n.replace(new RegExp("\\n([^\\n"+r+"])","g")," $1")).replace(/\[br\]/g,"\n\n")):(n="<p>"+n.replace(new RegExp("\\n\\n([^"+r+"])","g"),"</p><p>$1")+"</p>",o.options.showLineBreaks&&(n=n.replace(new RegExp("\\n([^\\n"+r+"])","g"),"<br />$1"))),t+n+r)})},m.replacer=function(e,t,n,r,i){var o=this,l=this.get(n);if(!l)return this.debug("invalid",{":tag":n}),i;r=this.args(l.attr,r);var a=i.replace(this.regC,function(e,t,n,r,i){return o.replacer.call(o,e,t,n,r,i)});if("function"==typeof l.open)var s=l.open.call(m,a,r,n);else s="string"==typeof l.open?l.open:"";if("function"==typeof l.close)var c=l.close.call(m,a,r,n);else c="string"==typeof l.close?l.close:"";return"display"in l&&!1===l.display?s+c:s+a+c},m.get=function(e){for(e=e?e.toLowerCase():"";e in m.Markups&&"string"==typeof e;){if("object"==typeof m.Markups[e])return m.Markups[e];e=m.Markups[e]}return!1},m.set=function(e,t){return!(e in m.Markups||"string"!=typeof e)&&(m.Markups[e]=object,!0)},m.config=function(e,t){if(e instanceof Object){for(var n in e)this.config(n,e[n]);return!0}return null==e?this.conf:null==t?e in this.conf?this.conf[e]:void 0:(this.conf[e]=t,!0)},m.Sanitize={text:function(e){return e.replace(/\&/g,"&#38;").replace(/\</g,"&#60;").replace(/\>/g,"&#62;").replace(/\"/g,"&#34;").replace(/\'/g,"&#39;")},url:function(e){e=0===e.indexOf("www.")?"http://"+e:e;return!!/^(?:https?|ftp|file|mailto|c):\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)$/i.test(e)&&e},mail:function(e){return!!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/i.test(e)&&e},font:function(e){return!!/^('|")?[a-z0-9_\-\s]+\1$/gi.test(e)&&e},size:function(e){if(e==parseInt(e))return parseInt(e).toString()+"px";return!!/^smaller|medium|larger|(?:(?:x{1,2}\-)?(?:small|large))|[0-9]{1,3}(?:\%|em|ex|px|cm|mm|in|pt|pc)$/i.test(e)&&e},color:function(e){if(document&&document.createElement){var t,n=document.createElement("IMG");return n.style.color="rgb(0, 0, 0)",n.style.color=e,t=n.style.color,n.style.color="rgb(255, 255, 255)",n.style.color=e,t==n.style.color&&e}return!!/(#[a-fA-F0-9]{3,6}|rgba?\(((25[0-5]|2[0-4]\d|1\d{1,2}|\d\d?)\s*,\s*?){2}(25[0-5]|2[0-4]\d|1\d{1,2}|\d\d?)\s*,?\s*([01]\.?\d*?)?\)|[a-z])/i.test(e)&&e}},m.Markups={bbcode:{open:"",close:"",container:!0},noparse:{open:"",close:"",parse:!1},"*common":{attr:["color","font","size"],open:function(e,t,n){var r,i={color:"color",size:"font-size",font:"font-family"},o=[];for(var l in i)l in t&&!1!==(r=this.Sanitize[l](t[l]))&&o.push([i[l],r]);return"<"+n+(0<o.length?' style="'+this.prop(o)+'"':"")+">"},close:function(e,t,n){return"</"+n+">"},placeholder:!0},font:{attr:[null,"font"],open:function(e,t,n){var r=t.font?this.Sanitize.font(t.font):"inherit";return'<span font="'+(r=r||"inherit")+'" style="font-family:'+r+';">'},close:"</span>"},size:{attr:[null,"size"],open:function(e,t,n){var r=t.size?this.Sanitize.size(t.size):"inherit";return'<span size="'+(r=r||"inherit")+'" style="font-size:'+r+';">'},close:"</span>"},color:{attr:[null,"color"],open:function(e,t,n){var r=t.color?this.Sanitize.color(t.color):"black";return'<span color="'+(r=r||"black")+'" style="color:'+r+';">'},close:"</span>"},code:{open:"<code>",close:"</code>",parse:!1},url:{attr:[null,"href","target"],open:function(e,t,n){(!t.href||t.href&&!this.Sanitize.url(t.href))&&(t.href="#");return(!t.target||t.target&&-1==["_blank","_parent","_self","_top"].indexOf(t.target))&&(t.target="_self"),"<a "+this.attr(t)+">"},close:"</a>"},mail:{attr:[null,"mail"],open:function(e,t,n){return(!t.mail||t.mail&&!this.Sanitize.mail(t.mail))&&(t.mail="#"),'<a href="mailto:'+t.mail+'">'},close:"</a>"},img:{attr:[null,"src","alt"],open:function(e,t,n){return t.src&&""!=t.src?!t.alt&&0<e.length&&(t.alt=e):t.src=e,(!t.src||t.src&&!this.Sanitize.url(t.src))&&(t.src="#"),t.alt&&(t.alt=this.Sanitize.text(t.alt)),"<img "+this.attr(t)+" />"},close:"",display:!1},h:{open:function(e,t,n){return"<"+(n="h"==n?"h1":n)+">"},close:function(e,t,n){return"</"+(n="h"==n?"h1":n)+">"},container:!0},hr:{open:"<hr />",close:"",display:!1,container:!0,single:!0},"*p":{open:function(e,t,n){return'<p align="'+n+'" style="text-align:'+n+';">'},close:"</p>",container:!0,placeholder:!0},quote:{attr:[null,"cite"],open:"<blockquote>",close:function(e,t,n){return t.cite?"<cite>"+this.Sanitize.text(t.cite)+"</cite></blockquote>":"</blockquote>"},container:!0},codeblock:{attr:[null,"language"],open:function(e,t,n){return t.language?(t.language=this.Sanitize.text(t.language),'<pre class="language-'+t.language+'"></code>'):"<pre></code>"},close:"</code></pre>",parse:!1,container:!0},table:{open:"<table>",close:"</table>",children:["thead","tbody","tfoot","tr"],container:!0},thead:{open:"<thead>",close:"</thead>",parents:["table"],children:["tr"],container:!0},tbody:{open:"<tbody>",close:"</tbody>",parents:["table"],children:["tr"],container:!0},tfoot:{open:"<tfoot>",close:"</tfoot>",parents:["table"],children:["tr"],container:!0},tr:{open:"<tr>",close:"</tr>",parents:["table","thead","tbody","tfoot"],children:["th","td"],container:!0},"*cell":{attr:["align","valign","colspan","rowspan"],open:function(e,t,n){t.align&&-1==["left","right","center","justify"].indexOf(t.align)&&delete t.align,t.valign&&-1==["top","middle","bottom","baseline"].indexOf(t.valign)&&delete t.valign,t.colspan&&isNaN(parseInt(t.colspan))&&delete t.colspan,t.rowpan&&isNaN(parseInt(t.rowpan))&&delete t.rowpan;var r=[];return t.align&&r.push("text-align",t.align),t.valign&&r.push("vertical-align",t.valign),"<"+n+" "+this.attr(t)+(0<=r.length?' style="'+this.prop(r)+'"':"")+">"},close:function(e,t,n){return"</"+n+">"},parents:["tr"],container:!0,placeholder:!0},list:{attr:[null,"type"],open:function(e,t,n){if("ol"==n?t.type="1":"ul"==n&&delete t.type,0<=["1","A","a","I","i"].indexOf(t.type||"")){return'<ol type="'+t.type+'" style="list-style:'+{1:"decimal",A:"lower-latin",a:"upper-latin",I:"lower-roman",i:"upper-roman"}[t.type]+';">'}return"<ul>"},close:function(e,t,n){return"ol"==n?t.type="1":"ul"==n&&delete t.type,0<=["1","A","a","I","i"].indexOf(t.type||"")?"</ol>":"</ul>"},children:["li","*"],container:!0},li:{open:"<li>",close:"</li>",parents:["list","ul","ol"],container:!0},"*":{open:"<li>",close:"</li>",single:!0,parents:["list","ul","ol"],container:!0},dl:{open:"<dl>",close:"</dl>",children:["dt","dd"],container:!0},dt:{open:"<dt>",close:"</dt>",parents:["dl"],container:!0},dd:{open:"<dd>",close:"</dd>",parents:["dl"],container:!0},b:"*common",strong:"*common",i:"*common",em:"*common",u:"*common",s:"*common",del:"*common",ins:"*common",sub:"*common",sup:"*common",big:"*common",small:"*common",h1:"h",h2:"h",h3:"h",h4:"h",h5:"h",h6:"h",left:"*p",right:"*p",center:"*p",justify:"*p",th:"*cell",td:"*cell",face:"font",large:"big",email:"mail",link:"url",image:"img",ol:"list",ul:"list",bbsolid:"noparse"},m});
